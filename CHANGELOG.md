# 📋 版本更新日志

## 版本说明

本文档记录了Web自动化测试工具（携程机票查询测试项目）的所有版本更新历史。

---

## [v2.0] - 2025-10-26

### 🎉 重大更新

本版本是针对软件测试比赛规范的重大改进版本，引入了需求管理、参数化测试和智能定位器生成等核心功能。

### ✨ 新增功能

#### 1. 需求管理系统
- ✅ **按需求编号分组管理测试用例**
  - 支持R001、R002等需求编号格式
  - 每个需求对应独立的测试函数
  - 自动生成规范的测试用例编号：`CtripFlight_R001_001`
  
- ✅ **需求切换命令**
  - 新增`req`/`需求`命令，支持在录制过程中动态切换需求
  - 显示当前需求编号和已有需求列表
  - 需求编号格式验证（必须为R+3位数字）

- ✅ **步骤管理功能**
  - 新增`l`命令：显示所有已录制步骤（按需求分组）
  - 新增`r`命令：删除指定步骤并自动重新编号
  - 实时显示总步骤数和需求数量

#### 2. 智能元素定位优化

- ✅ **使用元素实际文本生成XPath**
  - 不再使用用户搜索文本，而是使用元素的完整实际文本
  - 精确匹配优先：`//button[text()='搜索']`
  - 包含匹配备选：`//button[contains(text(), '搜索')]`
  - 自动处理单引号转义问题

- ✅ **备选定位器容错机制**
  - 每个元素生成3-5个备选定位器
  - 运行时主定位器失败自动尝试备选定位器
  - 智能选择不同类型的定位器（XPath、CSS、ID、属性等）
  - 避免选择过长（>100字符）或不稳定的CSS路径

- ✅ **定位器优先级优化**
  1. 🥇 LINK_TEXT（链接文本，最稳定）
  2. 🥈 XPATH精确文本匹配
  3. 🥉 NAME属性
  4. 🏅 ID选择器（过滤动态ID）
  5. 🎖️ 稳定的CSS选择器

#### 3. 强力清空输入框（四重机制）

- ✅ **方法1：物理键盘操作**
  - 三次Ctrl+A + Backspace
  - 最可靠的物理按键模拟

- ✅ **方法2：JavaScript强制清空**
  - 直接修改value属性
  - 触发input和change事件
  - 绕过React/Vue等框架的输入拦截

- ✅ **方法3：标准clear()方法**
  - 兼容传统输入框

- ✅ **方法4：再次全选删除**
  - 最后一次确认清空操作

#### 4. Pytest参数化测试

- ✅ **参数化测试数据结构**
  - 每个需求对应一个`TEST_DATA_R001`数据集
  - 每个步骤作为独立的测试用例执行
  - 支持自定义测试ID显示

- ✅ **统一的操作执行方法**
  - `execute_action()`方法支持所有操作类型
  - 自动处理click/input/hover/window_switch
  - 内置备选定位器重试机制

#### 5. 浏览器生命周期管理

- ✅ **Try-Finally确保关闭**
  - fixture使用try-finally块
  - 即使测试失败也能正确关闭浏览器
  - 避免浏览器进程残留

- ✅ **灵活的Scope配置**
  - `scope="class"`：所有测试共用一个浏览器（快速）
  - `scope="function"`：每个测试独立浏览器（隔离）

#### 6. 调试与日志增强

- ✅ **详细的定位器日志**
  - 打印主定位器信息
  - 显示备选定位器数量
  - 记录定位成功/失败状态
  - 显示尝试的每个备选定位器

- ✅ **实时反馈**
  - 录制时显示测试用例编号
  - 显示定位方式和定位器详情
  - 输入数据确认

### 🔧 改进优化

#### 代码架构
- ✅ **模块化设计**
  - 拆分为多个专职类：Config、ElementLocatorGenerator、TestScriptGenerator等
  - 单一职责原则，代码可维护性提升
  
- ✅ **配置集中管理**
  - Config类统一管理所有配置项
  - 超时时间、文件路径、命令关键词等可配置

#### 定位器生成
- ✅ **过滤动态值**
  - 检测并跳过CSS Modules哈希值
  - 识别时间戳和随机字符串
  - 只使用稳定的ID和class

- ✅ **CSS路径优化**
  - 模仿Chrome开发者工具策略
  - 只使用容器级别的class（-container、-wrapper、Module等）
  - 跳过内容级别的class（-item、-text、-link等）
  - 遇到ID立即停止向上查找

#### 测试脚本质量
- ✅ **符合比赛规范**
  - 测试用例编号格式：`CtripFlight_R001_001`
  - 截图文件名格式：`时间戳_测试用例编号.png`
  - 需求编号格式验证

- ✅ **参数化优势**
  - 每个步骤独立执行和报告
  - 失败步骤不影响后续步骤
  - 清晰的测试用例ID显示

### 🐛 Bug修复

- ✅ **修复携程输入框无法清空问题**
  - 携程使用自定义输入控件，标准clear()失效
  - 使用四重清空机制彻底解决

- ✅ **修复XPath单引号转义问题**
  - 元素文本包含单引号时XPath语法错误
  - 自动切换使用双引号包裹

- ✅ **修复CSS路径包含动态class**
  - 过滤CSS Modules哈希值
  - 过滤随机生成的class名称

- ✅ **修复浏览器未正确关闭**
  - 使用try-finally确保关闭
  - 即使测试中断也能清理资源

### 📝 文档更新

- ✅ **README.md大幅扩充**
  - 详细的功能说明（415行）
  - 完整的使用指南和示例
  - 常见问题解答
  - 最佳实践建议

- ✅ **命令参考表**
  - 所有支持的命令及用法
  - 清晰的示例演示

### 🎯 已知限制

- ⚠️ 窗口切换操作不支持备选定位器
- ⚠️ iframe内的元素需要手动切换
- ⚠️ Shadow DOM内的元素暂不支持

---

## [v1.0] - 2025-10-15

### 🎉 首次发布

这是本项目的初始版本，实现了Web自动化测试录制和回放的核心功能。

### ✨ 新增功能

#### 1. 基础录制功能
- ✅ 通过文本查找元素
- ✅ 点击操作录制
- ✅ 输入操作录制
- ✅ 鼠标悬浮操作录制

#### 2. 元素定位
- ✅ 自动生成多种定位器（XPath、CSS、ID、Name等）
- ✅ 选择最优定位器
- ✅ 支持精确匹配和模糊匹配

#### 3. 测试脚本生成
- ✅ 自动生成Selenium测试脚本
- ✅ 使用Pytest框架
- ✅ 包含ChromeDriver配置

#### 4. 窗口管理
- ✅ 多窗口切换
- ✅ 自动检测新窗口
- ✅ 窗口列表显示

#### 5. 自动截图
- ✅ 每个操作自动截图
- ✅ 时间戳文件名
- ✅ 截图保存到screenshots目录

#### 6. 交互式界面
- ✅ 命令行交互界面
- ✅ 实时高亮元素
- ✅ 多元素选择支持

### 🔧 技术栈

- Python 3.7+
- Selenium 4.0+
- Pytest 7.0+
- Chrome + ChromeDriver

### 📝 文档

- ✅ 基础README文档
- ✅ 环境要求说明
- ✅ 快速开始指南

---

## 版本规划

### [v2.1] - 计划中

#### 功能增强
- [ ] 支持iframe自动检测和切换
- [ ] 支持Shadow DOM元素定位
- [ ] 添加等待策略配置（显式等待、隐式等待）
- [ ] 支持数据驱动测试（Excel/CSV）

#### 定位器优化
- [ ] 添加更多智能定位策略
- [ ] 支持自定义定位器优先级
- [ ] 定位器稳定性评分系统

#### 用户体验
- [ ] 添加录制回放预览
- [ ] 支持断点调试模式
- [ ] 添加GUI图形界面

#### 报告增强
- [ ] 集成Allure测试报告
- [ ] 失败步骤自动截图
- [ ] 生成测试覆盖率报告

### [v3.0] - 远期规划

- [ ] 支持多浏览器（Firefox、Edge、Safari）
- [ ] 云端测试平台集成
- [ ] AI辅助元素识别
- [ ] 性能测试集成
- [ ] API测试支持

---

## 维护记录

### 2025-10-26
- 发布v2.0版本
- 新增需求管理系统
- 优化定位器生成算法
- 修复多个已知问题

### 2025-10-15
- 发布v1.0版本
- 项目初始化
- 核心功能实现

---

## 贡献指南

欢迎提交Issue和Pull Request！

### 提交Issue
- 清晰描述问题或建议
- 提供复现步骤（如果是Bug）
- 附上环境信息（Python版本、Selenium版本等）

### 提交代码
- Fork本仓库
- 创建功能分支（`git checkout -b feature/AmazingFeature`）
- 提交更改（`git commit -m 'Add some AmazingFeature'`）
- 推送到分支（`git push origin feature/AmazingFeature`）
- 开启Pull Request

---

## 许可证

本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

---

## 联系方式

- 项目仓库：GitHub（待添加）
- 问题反馈：Issues页面
- 邮箱：待添加

---

**最后更新**: 2025-10-26  
**当前版本**: v2.0  
**维护状态**: 🟢 积极维护中

